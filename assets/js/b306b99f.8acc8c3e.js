"use strict";(globalThis.webpackChunkbook=globalThis.webpackChunkbook||[]).push([[5546],{846:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"book-tutorial/module-2/quickstart/digital-twin-quickstart","title":"Quickstart Guide: Digital Twin Setup","description":"This guide will help you set up your first Gazebo-Unity digital twin system. Follow these steps to create a basic integrated environment for physics simulation and high-fidelity visualization.","source":"@site/docs/book-tutorial/module-2/quickstart/digital-twin-quickstart.md","sourceDirName":"book-tutorial/module-2/quickstart","slug":"/book-tutorial/module-2/quickstart/digital-twin-quickstart","permalink":"/physical-ai-book/docs/book-tutorial/module-2/quickstart/digital-twin-quickstart","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/book-tutorial/module-2/quickstart/digital-twin-quickstart.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Quickstart Guide: Digital Twin Setup"},"sidebar":"bookTutorial","previous":{"title":"Physics Simulation with Gazebo","permalink":"/physical-ai-book/docs/book-tutorial/module-2/physics/physics-simulation"},"next":{"title":"Sensor Simulation in Gazebo","permalink":"/physical-ai-book/docs/book-tutorial/module-2/sensors/sensor-simulation"}}');var t=r(4848),s=r(8453);const o={sidebar_position:5,title:"Quickstart Guide: Digital Twin Setup"},a="Quickstart Guide: Digital Twin Setup",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"System Requirements",id:"system-requirements",level:3},{value:"Software Dependencies",id:"software-dependencies",level:3},{value:"For Gazebo Environment:",id:"for-gazebo-environment",level:4},{value:"For Unity Environment:",id:"for-unity-environment",level:4},{value:"Step 1: Setting Up Gazebo Simulation",id:"step-1-setting-up-gazebo-simulation",level:2},{value:"1.1 Create a ROS Workspace",id:"11-create-a-ros-workspace",level:3},{value:"1.2 Create a Simple Robot Model",id:"12-create-a-simple-robot-model",level:3},{value:"1.3 Create a World File",id:"13-create-a-world-file",level:3},{value:"1.4 Launch the Simulation",id:"14-launch-the-simulation",level:3},{value:"Step 2: Setting Up Unity Visualization",id:"step-2-setting-up-unity-visualization",level:2},{value:"2.1 Create a New Unity Project",id:"21-create-a-new-unity-project",level:3},{value:"2.2 Import Required Packages",id:"22-import-required-packages",level:3},{value:"2.3 Create Basic Scene Structure",id:"23-create-basic-scene-structure",level:3},{value:"2.4 Implement Gazebo Connection Script",id:"24-implement-gazebo-connection-script",level:3},{value:"2.5 Create Visualization Environment",id:"25-create-visualization-environment",level:3},{value:"2.6 Set Up Camera and Lighting",id:"26-set-up-camera-and-lighting",level:3},{value:"Step 3: Establishing Communication",id:"step-3-establishing-communication",level:2},{value:"3.1 Create a Simple Communication Bridge",id:"31-create-a-simple-communication-bridge",level:3},{value:"3.2 Launch the Bridge",id:"32-launch-the-bridge",level:3},{value:"Step 4: Running the Integrated System",id:"step-4-running-the-integrated-system",level:2},{value:"4.1 Start the Components in Order",id:"41-start-the-components-in-order",level:3},{value:"4.2 Verify Connection",id:"42-verify-connection",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"quickstart-guide-digital-twin-setup",children:"Quickstart Guide: Digital Twin Setup"})}),"\n",(0,t.jsx)(n.p,{children:"This guide will help you set up your first Gazebo-Unity digital twin system. Follow these steps to create a basic integrated environment for physics simulation and high-fidelity visualization."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Before starting, ensure you have the following software installed:"}),"\n",(0,t.jsx)(n.h3,{id:"system-requirements",children:"System Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Operating System"}),": Ubuntu 20.04/22.04 (for Gazebo) or Windows 10/11 (for Unity)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RAM"}),": 8GB minimum, 16GB recommended"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"GPU"}),": Dedicated graphics card with at least 2GB VRAM"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Storage"}),": 10GB available space"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"software-dependencies",children:"Software Dependencies"}),"\n",(0,t.jsx)(n.h4,{id:"for-gazebo-environment",children:"For Gazebo Environment:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Ubuntu/Debian\r\nsudo apt update\r\nsudo apt install ros-noetic-desktop-full\r\nsudo apt install gazebo11 libgazebo11-dev\r\nsudo apt install ros-noetic-gazebo-ros-pkgs ros-noetic-gazebo-ros-control\r\nsudo apt install ros-noetic-rosbridge-suite\n"})}),"\n",(0,t.jsx)(n.h4,{id:"for-unity-environment",children:"For Unity Environment:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Unity Hub 3.0+"}),"\n",(0,t.jsx)(n.li,{children:"Unity Editor 2021.3 LTS or later"}),"\n",(0,t.jsx)(n.li,{children:"Visual Studio 2019 or Rider"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-1-setting-up-gazebo-simulation",children:"Step 1: Setting Up Gazebo Simulation"}),"\n",(0,t.jsx)(n.h3,{id:"11-create-a-ros-workspace",children:"1.1 Create a ROS Workspace"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create and navigate to workspace\r\nmkdir -p ~/digital_twin_ws/src\r\ncd ~/digital_twin_ws\r\n\r\n# Source ROS environment\r\nsource /opt/ros/noetic/setup.bash\r\n\r\n# Initialize the workspace\r\ncatkin_make\r\nsource devel/setup.bash\n"})}),"\n",(0,t.jsx)(n.h3,{id:"12-create-a-simple-robot-model",children:"1.2 Create a Simple Robot Model"}),"\n",(0,t.jsxs)(n.p,{children:["Create a basic robot model in ",(0,t.jsx)(n.code,{children:"~/digital_twin_ws/src/digital_twin_robot"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/digital_twin_ws/src\r\ncatkin_create_pkg digital_twin_robot rospy std_msgs sensor_msgs geometry_msgs\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Create the robot's URDF file at ",(0,t.jsx)(n.code,{children:"~/digital_twin_ws/src/digital_twin_robot/urdf/simple_robot.urdf"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<robot name="simple_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\r\n  \x3c!-- Base Link --\x3e\r\n  <link name="base_link">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.5 0.3 0.2"/>\r\n      </geometry>\r\n      <material name="blue">\r\n        <color rgba="0 0 1 0.8"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <box size="0.5 0.3 0.2"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="1.0"/>\r\n      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  \x3c!-- LiDAR Sensor --\x3e\r\n  <link name="lidar_link">\r\n    <visual>\r\n      <geometry>\r\n        <cylinder radius="0.05" length="0.05"/>\r\n      </geometry>\r\n      <material name="red">\r\n        <color rgba="1 0 0 0.8"/>\r\n      </material>\r\n    </visual>\r\n  </link>\r\n\r\n  <joint name="lidar_joint" type="fixed">\r\n    <parent link="base_link"/>\r\n    <child link="lidar_link"/>\r\n    <origin xyz="0.15 0 0.1" rpy="0 0 0"/>\r\n  </joint>\r\n\r\n  \x3c!-- IMU Sensor --\x3e\r\n  <link name="imu_link">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.02 0.02 0.02"/>\r\n      </geometry>\r\n      <material name="green">\r\n        <color rgba="0 1 0 0.8"/>\r\n      </material>\r\n    </visual>\r\n  </link>\r\n\r\n  <joint name="imu_joint" type="fixed">\r\n    <parent link="base_link"/>\r\n    <child link="imu_link"/>\r\n    <origin xyz="0 0 0.05" rpy="0 0 0"/>\r\n  </joint>\r\n\r\n  \x3c!-- Gazebo Plugins --\x3e\r\n  <gazebo reference="base_link">\r\n    <material>Gazebo/Blue</material>\r\n  </gazebo>\r\n\r\n  <gazebo reference="lidar_link">\r\n    <material>Gazebo/Red</material>\r\n    <sensor name="lidar_sensor" type="ray">\r\n      <pose>0 0 0 0 0 0</pose>\r\n      <ray>\r\n        <scan>\r\n          <horizontal>\r\n            <samples>360</samples>\r\n            <resolution>1</resolution>\r\n            <min_angle>-3.14159</min_angle>\r\n            <max_angle>3.14159</max_angle>\r\n          </horizontal>\r\n        </scan>\r\n        <range>\r\n          <min>0.1</min>\r\n          <max>30.0</max>\r\n          <resolution>0.01</resolution>\r\n        </range>\r\n      </ray>\r\n      <plugin name="lidar_controller" filename="libgazebo_ros_laser.so">\r\n        <topicName>/scan</topicName>\r\n        <frameName>lidar_link</frameName>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n\r\n  <gazebo reference="imu_link">\r\n    <sensor name="imu_sensor" type="imu">\r\n      <always_on>true</always_on>\r\n      <update_rate>100</update_rate>\r\n      <plugin name="imu_controller" filename="libgazebo_ros_imu.so">\r\n        <topicName>/imu/data</topicName>\r\n        <bodyName>imu_link</bodyName>\r\n        <frameName>imu_link</frameName>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n</robot>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"13-create-a-world-file",children:"1.3 Create a World File"}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"~/digital_twin_ws/src/digital_twin_robot/worlds/simple_world.world"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" ?>\r\n<sdf version="1.7">\r\n  <world name="simple_world">\r\n    <include>\r\n      <uri>model://ground_plane</uri>\r\n    </include>\r\n\r\n    <include>\r\n      <uri>model://sun</uri>\r\n    </include>\r\n\r\n    <physics type="ode">\r\n      <max_step_size>0.001</max_step_size>\r\n      <real_time_factor>1.0</real_time_factor>\r\n      <real_time_update_rate>1000.0</real_time_update_rate>\r\n    </physics>\r\n\r\n    \x3c!-- Add some obstacles --\x3e\r\n    <model name="box1">\r\n      <pose>2 0 0.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>1 1 1</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>1 1 1</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.2 0.2 1</ambient>\r\n            <diffuse>0.8 0.2 0.2 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>1.0</mass>\r\n          <inertia>\r\n            <ixx>0.1667</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>0.1667</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>0.1667</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n  </world>\r\n</sdf>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"14-launch-the-simulation",children:"1.4 Launch the Simulation"}),"\n",(0,t.jsxs)(n.p,{children:["Create a launch file at ",(0,t.jsx)(n.code,{children:"~/digital_twin_ws/src/digital_twin_robot/launch/simple_robot.launch"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<launch>\r\n  \x3c!-- Start Gazebo with world --\x3e\r\n  <include file="$(find gazebo_ros)/launch/empty_world.launch">\r\n    <arg name="world_name" value="$(find digital_twin_robot)/worlds/simple_world.world"/>\r\n    <arg name="paused" value="false"/>\r\n    <arg name="use_sim_time" value="true"/>\r\n    <arg name="gui" value="true"/>\r\n    <arg name="headless" value="false"/>\r\n    <arg name="debug" value="false"/>\r\n  </include>\r\n\r\n  \x3c!-- Load robot description --\x3e\r\n  <param name="robot_description" command="$(find xacro)/xacro $(find digital_twin_robot)/urdf/simple_robot.urdf" />\r\n\r\n  \x3c!-- Spawn robot in Gazebo --\x3e\r\n  <node name="spawn_urdf" pkg="gazebo_ros" type="spawn_model"\r\n        args="-param robot_description -urdf -model simple_robot -x 0 -y 0 -z 0.5" />\r\n\r\n  \x3c!-- Start ROS Bridge --\x3e\r\n  <include file="$(find rosbridge_server)/launch/rosbridge_websocket.launch">\r\n    <arg name="port" value="9090"/>\r\n  </include>\r\n</launch>\n'})}),"\n",(0,t.jsx)(n.p,{children:"Launch the simulation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/digital_twin_ws\r\nsource devel/setup.bash\r\nroslaunch digital_twin_robot simple_robot.launch\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-2-setting-up-unity-visualization",children:"Step 2: Setting Up Unity Visualization"}),"\n",(0,t.jsx)(n.h3,{id:"21-create-a-new-unity-project",children:"2.1 Create a New Unity Project"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Open Unity Hub"}),"\n",(0,t.jsx)(n.li,{children:'Click "New Project"'}),"\n",(0,t.jsx)(n.li,{children:'Select "3D (Built-in Render Pipeline)" or "3D (URP)"'}),"\n",(0,t.jsx)(n.li,{children:'Name the project "DigitalTwinVisualization"'}),"\n",(0,t.jsx)(n.li,{children:"Create the project"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"22-import-required-packages",children:"2.2 Import Required Packages"}),"\n",(0,t.jsx)(n.p,{children:"In Unity, go to Window > Package Manager and install:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ProBuilder"})," (for quick environment creation)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ProGrids"})," (for precise placement)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TextMeshPro"})," (for UI text)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"23-create-basic-scene-structure",children:"2.3 Create Basic Scene Structure"}),"\n",(0,t.jsx)(n.p,{children:"Create the following folder structure in Assets:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Assets/\r\n\u251c\u2500\u2500 Scripts/\r\n\u251c\u2500\u2500 Materials/\r\n\u251c\u2500\u2500 Models/\r\n\u251c\u2500\u2500 Scenes/\r\n\u2514\u2500\u2500 Plugins/\n"})}),"\n",(0,t.jsx)(n.h3,{id:"24-implement-gazebo-connection-script",children:"2.4 Implement Gazebo Connection Script"}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"Assets/Scripts/GazeboConnection.cs"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'using System.Collections;\r\nusing System.Collections.Generic;\r\nusing UnityEngine;\r\nusing System.Net.Sockets;\r\nusing System.Text;\r\nusing Newtonsoft.Json;\r\n\r\npublic class GazeboConnection : MonoBehaviour\r\n{\r\n    [Header("Connection Settings")]\r\n    public string gazeboHost = "127.0.0.1";\r\n    public int gazeboPort = 5000;\r\n    public float updateRate = 100f; // Hz\r\n\r\n    [Header("Robot References")]\r\n    public Transform robotRoot;\r\n    public Transform lidarPoint;\r\n    public Transform imuPoint;\r\n\r\n    private TcpClient tcpClient;\r\n    private NetworkStream stream;\r\n    private bool isConnected = false;\r\n\r\n    void Start()\r\n    {\r\n        StartCoroutine(ConnectToGazebo());\r\n    }\r\n\r\n    IEnumerator ConnectToGazebo()\r\n    {\r\n        yield return new WaitForSeconds(1f); // Wait a bit before connecting\r\n\r\n        try\r\n        {\r\n            tcpClient = new TcpClient(gazeboHost, gazeboPort);\r\n            stream = tcpClient.GetStream();\r\n            isConnected = true;\r\n            Debug.Log("Connected to Gazebo simulation");\r\n        }\r\n        catch (System.Exception e)\r\n        {\r\n            Debug.LogError($"Failed to connect to Gazebo: {e.Message}");\r\n        }\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        if (isConnected && tcpClient.Connected)\r\n        {\r\n            // Process incoming data in a separate coroutine\r\n            StartCoroutine(ReceiveAndProcessData());\r\n        }\r\n    }\r\n\r\n    IEnumerator ReceiveAndProcessData()\r\n    {\r\n        if (stream.DataAvailable)\r\n        {\r\n            byte[] buffer = new byte[4096];\r\n            int bytesRead = stream.Read(buffer, 0, buffer.Length);\r\n\r\n            if (bytesRead > 0)\r\n            {\r\n                string data = Encoding.UTF8.GetString(buffer, 0, bytesRead);\r\n                ProcessGazeboData(data);\r\n            }\r\n        }\r\n\r\n        yield return null;\r\n    }\r\n\r\n    void ProcessGazeboData(string jsonData)\r\n    {\r\n        try\r\n        {\r\n            GazeboState state = JsonConvert.DeserializeObject<GazeboState>(jsonData);\r\n\r\n            // Update robot position\r\n            if (robotRoot != null)\r\n            {\r\n                robotRoot.position = new Vector3(\r\n                    (float)state.robot_state.position.x,\r\n                    (float)state.robot_state.position.z, // Swap Y and Z for Unity\r\n                    (float)state.robot_state.position.y\r\n                );\r\n\r\n                // Convert Gazebo quaternion to Unity quaternion\r\n                robotRoot.rotation = new Quaternion(\r\n                    (float)state.robot_state.orientation.x,\r\n                    (float)state.robot_state.orientation.z,\r\n                    (float)state.robot_state.orientation.y,\r\n                    (float)state.robot_state.orientation.w\r\n                );\r\n            }\r\n\r\n            // Update sensor positions if needed\r\n            if (lidarPoint != null)\r\n            {\r\n                lidarPoint.position = robotRoot.position + robotRoot.forward * 0.15f + robotRoot.up * 0.1f;\r\n            }\r\n        }\r\n        catch (System.Exception e)\r\n        {\r\n            Debug.LogError($"Error processing Gazebo data: {e.Message}");\r\n        }\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class GazeboState\r\n    {\r\n        public double timestamp;\r\n        public RobotState robot_state;\r\n        public SensorData sensor_data;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class RobotState\r\n    {\r\n        public Position position;\r\n        public Orientation orientation;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class Position\r\n    {\r\n        public double x, y, z;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class Orientation\r\n    {\r\n        public double x, y, z, w; // Quaternion\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class SensorData\r\n    {\r\n        public LidarData lidar;\r\n        public ImuData imu;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class LidarData\r\n    {\r\n        public List<double> ranges = new List<double>();\r\n        public double angle_min;\r\n        public double angle_max;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class ImuData\r\n    {\r\n        public Acceleration acceleration;\r\n        public AngularVelocity angular_velocity;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class Acceleration\r\n    {\r\n        public double x, y, z;\r\n    }\r\n\r\n    [System.Serializable]\r\n    public class AngularVelocity\r\n    {\r\n        public double x, y, z;\r\n    }\r\n\r\n    void OnDestroy()\r\n    {\r\n        if (tcpClient != null)\r\n        {\r\n            tcpClient.Close();\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"25-create-visualization-environment",children:"2.5 Create Visualization Environment"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a new scene: File > New Scene"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Add a plane for the ground"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a simple robot model:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create a cube for the base"}),"\n",(0,t.jsx)(n.li,{children:"Create a cylinder for the LiDAR"}),"\n",(0,t.jsx)(n.li,{children:"Create a small cube for the IMU"}),"\n",(0,t.jsx)(n.li,{children:"Parent them to a root GameObject"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Attach the GazeboConnection script to the root GameObject"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Assign the robot components in the Inspector"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"26-set-up-camera-and-lighting",children:"2.6 Set Up Camera and Lighting"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Position the Main Camera to view the robot"}),"\n",(0,t.jsx)(n.li,{children:"Add directional light to simulate environment lighting"}),"\n",(0,t.jsx)(n.li,{children:"Set up a basic material for the robot"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-3-establishing-communication",children:"Step 3: Establishing Communication"}),"\n",(0,t.jsx)(n.h3,{id:"31-create-a-simple-communication-bridge",children:"3.1 Create a Simple Communication Bridge"}),"\n",(0,t.jsx)(n.p,{children:"Instead of using ROS Bridge for this quickstart, create a custom TCP server in Python that connects to Gazebo:"}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"~/digital_twin_ws/src/digital_twin_robot/scripts/gazebo_to_unity_bridge.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\nimport rospy\r\nimport socket\r\nimport json\r\nimport threading\r\nfrom nav_msgs.msg import Odometry\r\nfrom sensor_msgs.msg import LaserScan, Imu\r\nfrom tf.transformations import euler_from_quaternion\r\n\r\nclass GazeboUnityBridge:\r\n    def __init__(self):\r\n        rospy.init_node('gazebo_unity_bridge')\r\n\r\n        # Communication setup\r\n        self.host = 'localhost'\r\n        self.port = 5000\r\n        self.clients = []\r\n        self.socket_lock = threading.Lock()\r\n\r\n        # Robot state\r\n        self.robot_state = {\r\n            'position': {'x': 0.0, 'y': 0.0, 'z': 0.0},\r\n            'orientation': {'x': 0.0, 'y': 0.0, 'z': 0.0, 'w': 1.0},\r\n            'timestamp': rospy.get_time()\r\n        }\r\n\r\n        self.sensor_data = {\r\n            'lidar': {'ranges': [10.0] * 360, 'angle_min': -3.14, 'angle_max': 3.14},\r\n            'imu': {'acceleration': {'x': 0.0, 'y': 0.0, 'z': 9.81},\r\n                   'angular_velocity': {'x': 0.0, 'y': 0.0, 'z': 0.0}}\r\n        }\r\n\r\n        # Subscribe to Gazebo topics\r\n        rospy.Subscriber('/odom', Odometry, self.odom_callback)\r\n        rospy.Subscriber('/scan', LaserScan, self.lidar_callback)\r\n        rospy.Subscriber('/imu/data', Imu, self.imu_callback)\r\n\r\n        # Start TCP server\r\n        self.start_server()\r\n\r\n        # Start broadcast thread\r\n        self.running = True\r\n        broadcast_thread = threading.Thread(target=self.broadcast_state)\r\n        broadcast_thread.daemon = True\r\n        broadcast_thread.start()\r\n\r\n        rospy.loginfo(\"Gazebo-Unity Bridge initialized\")\r\n\r\n    def odom_callback(self, msg):\r\n        \"\"\"Process odometry messages from Gazebo\"\"\"\r\n        self.robot_state['position']['x'] = msg.pose.pose.position.x\r\n        self.robot_state['position']['y'] = msg.pose.pose.position.y\r\n        self.robot_state['position']['z'] = msg.pose.pose.position.z\r\n\r\n        self.robot_state['orientation']['x'] = msg.pose.pose.orientation.x\r\n        self.robot_state['orientation']['y'] = msg.pose.pose.orientation.y\r\n        self.robot_state['orientation']['z'] = msg.pose.pose.orientation.z\r\n        self.robot_state['orientation']['w'] = msg.pose.pose.orientation.w\r\n\r\n        self.robot_state['timestamp'] = rospy.get_time()\r\n\r\n    def lidar_callback(self, msg):\r\n        \"\"\"Process LiDAR messages from Gazebo\"\"\"\r\n        self.sensor_data['lidar']['ranges'] = [r if r < msg.range_max else msg.range_max for r in msg.ranges]\r\n        self.sensor_data['lidar']['angle_min'] = msg.angle_min\r\n        self.sensor_data['lidar']['angle_max'] = msg.angle_max\r\n\r\n    def imu_callback(self, msg):\r\n        \"\"\"Process IMU messages from Gazebo\"\"\"\r\n        self.sensor_data['imu']['acceleration']['x'] = msg.linear_acceleration.x\r\n        self.sensor_data['imu']['acceleration']['y'] = msg.linear_acceleration.y\r\n        self.sensor_data['imu']['acceleration']['z'] = msg.linear_acceleration.z\r\n\r\n        self.sensor_data['imu']['angular_velocity']['x'] = msg.angular_velocity.x\r\n        self.sensor_data['imu']['angular_velocity']['y'] = msg.angular_velocity.y\r\n        self.sensor_data['imu']['angular_velocity']['z'] = msg.angular_velocity.z\r\n\r\n    def start_server(self):\r\n        \"\"\"Start TCP server to communicate with Unity\"\"\"\r\n        self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n        self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\r\n        self.server_socket.bind((self.host, self.port))\r\n        self.server_socket.listen(5)\r\n\r\n        server_thread = threading.Thread(target=self.accept_connections)\r\n        server_thread.daemon = True\r\n        server_thread.start()\r\n\r\n        rospy.loginfo(f\"TCP Server listening on {self.host}:{self.port}\")\r\n\r\n    def accept_connections(self):\r\n        \"\"\"Accept client connections\"\"\"\r\n        while not rospy.is_shutdown():\r\n            try:\r\n                client_socket, address = self.server_socket.accept()\r\n                rospy.loginfo(f\"Unity client connected: {address}\")\r\n\r\n                with self.socket_lock:\r\n                    self.clients.append(client_socket)\r\n\r\n                # Send initial state to new client\r\n                self.send_initial_state(client_socket)\r\n            except socket.error as e:\r\n                if not rospy.is_shutdown():\r\n                    rospy.logerr(f\"Error accepting connections: {e}\")\r\n\r\n    def send_initial_state(self, client_socket):\r\n        \"\"\"Send initial robot state to new client\"\"\"\r\n        initial_state = {\r\n            'timestamp': rospy.get_time(),\r\n            'robot_state': self.robot_state,\r\n            'sensor_data': self.sensor_data\r\n        }\r\n\r\n        try:\r\n            message_json = json.dumps(initial_state)\r\n            client_socket.send(message_json.encode('utf-8'))\r\n        except Exception as e:\r\n            rospy.logerr(f\"Error sending initial state: {e}\")\r\n            self.remove_client(client_socket)\r\n\r\n    def broadcast_state(self):\r\n        \"\"\"Broadcast robot state to all connected clients\"\"\"\r\n        rate = rospy.Rate(50)  # 50 Hz update rate\r\n\r\n        while not rospy.is_shutdown() and self.running:\r\n            message = {\r\n                'timestamp': rospy.get_time(),\r\n                'robot_state': self.robot_state,\r\n                'sensor_data': self.sensor_data\r\n            }\r\n\r\n            message_json = json.dumps(message)\r\n            message_bytes = message_json.encode('utf-8')\r\n\r\n            disconnected_clients = []\r\n            with self.socket_lock:\r\n                for client in self.clients:\r\n                    try:\r\n                        client.send(message_bytes)\r\n                    except socket.error as e:\r\n                        rospy.logwarn(f\"Removing disconnected client: {e}\")\r\n                        disconnected_clients.append(client)\r\n\r\n                for client in disconnected_clients:\r\n                    if client in self.clients:\r\n                        self.clients.remove(client)\r\n                        client.close()\r\n\r\n            rate.sleep()\r\n\r\n    def remove_client(self, client_socket):\r\n        \"\"\"Remove a disconnected client\"\"\"\r\n        with self.socket_lock:\r\n            if client_socket in self.clients:\r\n                self.clients.remove(client_socket)\r\n                client_socket.close()\r\n\r\nif __name__ == '__main__':\r\n    try:\r\n        bridge = GazeboUnityBridge()\r\n        rospy.spin()\r\n    except rospy.ROSInterruptException:\r\n        rospy.loginfo(\"Gazebo-Unity Bridge shutting down\")\r\n    except KeyboardInterrupt:\r\n        rospy.loginfo(\"Gazebo-Unity Bridge interrupted\")\n"})}),"\n",(0,t.jsx)(n.h3,{id:"32-launch-the-bridge",children:"3.2 Launch the Bridge"}),"\n",(0,t.jsx)(n.p,{children:"Make the script executable and run it:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/digital_twin_ws\r\nchmod +x src/digital_twin_robot/scripts/gazebo_to_unity_bridge.py\r\nsource devel/setup.bash\r\nrosrun digital_twin_robot gazebo_to_unity_bridge.py\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-4-running-the-integrated-system",children:"Step 4: Running the Integrated System"}),"\n",(0,t.jsx)(n.h3,{id:"41-start-the-components-in-order",children:"4.1 Start the Components in Order"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Start Gazebo simulation"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/digital_twin_ws\r\nsource devel/setup.bash\r\nroslaunch digital_twin_robot simple_robot.launch\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Start the bridge"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/digital_twin_ws\r\nsource devel/setup.bash\r\nrosrun digital_twin_robot gazebo_to_unity_bridge.py\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Run Unity visualization"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Open the Unity project"}),"\n",(0,t.jsx)(n.li,{children:"Hit Play in the Unity Editor"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"42-verify-connection",children:"4.2 Verify Connection"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check that the robot model moves in Unity when it moves in Gazebo"}),"\n",(0,t.jsx)(n.li,{children:"Verify that sensor data is being transmitted"}),"\n",(0,t.jsx)(n.li,{children:"Confirm that the Unity visualization updates in real-time"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Connection Refused"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify that the TCP server is running"}),"\n",(0,t.jsx)(n.li,{children:"Check firewall settings"}),"\n",(0,t.jsx)(n.li,{children:"Ensure Unity and Gazebo are on the same network"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Robot Not Moving in Unity"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check that the robot references are assigned in Unity Inspector"}),"\n",(0,t.jsx)(n.li,{children:"Verify coordinate system transformations"}),"\n",(0,t.jsx)(n.li,{children:"Ensure both systems are using the same update rate"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Performance Issues"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Reduce the update rate in both systems"}),"\n",(0,t.jsx)(n.li,{children:"Simplify the Unity model"}),"\n",(0,t.jsx)(n.li,{children:"Check network bandwidth usage"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Data Synchronization Problems"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Implement interpolation between state updates"}),"\n",(0,t.jsx)(n.li,{children:"Check for time drift between systems"}),"\n",(0,t.jsx)(n.li,{children:"Add connection health monitoring"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(n.p,{children:"Congratulations! You now have a basic Gazebo-Unity digital twin system running. To enhance your setup:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Advanced Sensors"}),": Add more complex sensor models (depth cameras, GPS)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multi-Robot Systems"}),": Extend to multiple robots in the same environment"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Control Interfaces"}),": Implement control commands from Unity to Gazebo"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cloud Integration"}),": Deploy the system to cloud infrastructure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Visualization Enhancements"}),": Add advanced rendering effects and UI elements"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Explore the other chapters in this module to dive deeper into specific aspects of digital twin development."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);